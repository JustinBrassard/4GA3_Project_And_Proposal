---
title: "Collisions in Relation to Speed Reduction Zones in Toronto"
thanks: Paper submitted to complete the requirements of ENVSOCTY 4GA3 Applied Spatial
  Statistics.
author: 
- name: Michel Giese,
  student_number: 400010952
- name: Justin Brassard,
  student_number: 400181410
- name: Mohammad Ali,
  student_number: 400079555
- name: Nathan Walschots,
  student_number: 400192318
subject: ENVSOCTY 4GA3
abstract: This paper reports our analysis of motor vehicle collisions in Toronto,
  Canada, and its relationship with the presence of speed reduction zones. Data were
  obtained from the City of Toronto open data website, as well as the City of Toronto
  Transportation Services department, and 311 Toronto.
keywords: "crash, motor vehicle collisions, schools, spatial analysis"
date: "4/9/2021"
output:
  pdf_document:
    template: project-template-default.tex
  html_document:
    df_print: paged
bibliography:
- bibliography.bib
- packages.bib
always_allow_html: yes
---

<!--Chunks of code can have names; the chunk option "include" controls whether the chunk and its output are printed in the final document-->
```{r load-packages, include=FALSE}
library(leaflet.extras)
library(sp)
library(leaflet)
library(tidyverse)
library(gstat)
library(sf)
library(readr)
library(spatstat)
library(maptools)
library(dplyr)
```

```{r write-package-bib, include=FALSE}
# This function is used to write a bibliography for the `R` packages used in the paper
knitr::write_bib(file = 'packages.bib')
```

```{r Import-Files, include=FALSE}
#importing necessary files from GitHub

collisionsfile="https://raw.githubusercontent.com/JustinBrassard/4GA3_Project_And_Proposal/main/data/Motor%20Vehicle%20Collisions/Motor%20Vehicle%20Collisions%20with%20KSI%20Data%20True.csv?token=AS22SR2ZGZO34O7CM56XBFTANDP44"

fullcollisionsfile = "https://raw.githubusercontent.com/JustinBrassard/4GA3_Project_And_Proposal/main/data/Motor%20Vehicle%20Collisions/Full_Collisions.csv"

kidcollisionsfile = "https://raw.githubusercontent.com/JustinBrassard/4GA3_Project_And_Proposal/main/data/Motor%20Vehicle%20Collisions/Kids%20Full%20Collisions%20-%20Motor%20Vehicle%20Collisions%20with%20KSI%20Data.csv"

zonesfile="https://raw.githubusercontent.com/JustinBrassard/4GA3_Project_And_Proposal/main/data/Stationary%20Sign%20locations/Stationary%20Sign%20Locations%20True%20-%20Stationary%20Sign%20locations.csv?token=AS22SR3YXJ3MMPTFKRTZFIDANDQKW"

schoolsfile="https://raw.githubusercontent.com/JustinBrassard/4GA3_Project_And_Proposal/main/data/point-school-locations-wgs84/School%20Locations%20True%20-%20School%20locations-all%20types%20data.csv?token=AS22SR3J4NEF54PS3OOARYTANDQOY"

boundsfile <- "https://raw.githubusercontent.com/JustinBrassard/4GA3_Project_And_Proposal/main/data/Toronto%20Boundary%20Points%20UTM15N/Toronto_Points.csv"


Motor_Vehicle_Collisions_with_KSI_Data_True<-read_csv(url(collisionsfile))
Full_Collisions<-read_csv(url(fullcollisionsfile))
Kid_Collisions<-read_csv(url(kidcollisionsfile))

Stationary_Sign_Locations_True<-read_csv(url(zonesfile))
School_Locations_True<-read_csv(url(schoolsfile))

Toronto_Points<-read_csv(url(boundsfile))
```

```{r Load-Data, include=FALSE}
#separation of 'geometry' column into two lng & lat columns for main data sets
School_Zones <- Stationary_Sign_Locations_True %>%
  separate(geometry, into = c('lng', 'lat'), sep = ', ')
Schools <- School_Locations_True %>%
  separate(geometry, into = c('lng', 'lat'), sep = ', ')

Collisions <- Motor_Vehicle_Collisions_with_KSI_Data_True %>%
  separate(geometry, into = c('lng', 'lat'), sep = ', ')
Full_Collisions <- Full_Collisions %>%
  separate(geometry, into = c('lng', 'lat'), sep = ', ')
Kid_Collisions <- Kid_Collisions %>%
  separate(geometry, into = c('lng', 'lat'), sep = ', ')
```

```{r Conversion-Data, include=FALSE}
#df to sf conversion of main data sets
School_Zones.sf <- st_as_sf(School_Zones, coords = c("lng", "lat"))
Schools.sf <- st_as_sf(Schools, coords = c("lng", "lat"))

Collisions.sf <- st_as_sf(Collisions, coords = c("lng", "lat"))
```

<!--This format should be used to comment out sections of code/text. Or just use [Shift + Ctrl + C] - MG-->
<!--This creates a page break, i.e., starts a new page-->
<!--\newpage-->

<!-- 
To cite references in your bibliography.bib file, use [@item] if you want it to be cited in brackets, or @item if you want it to be cited as Name (year). If you want to cite various items in brackets, separate them with semicolons [@item1; @item2]
-->

<!--Use "#" for section headers-->
# Introduction

  The goal of this project is to explore the relationships between motor vehicle collisions (strictly involving pedestrians), and speed reduction zones within Toronto. To draw conclusions, data from various sources have been acquired in order to establish trends from previous years. General trends on this relationship were determined before the data were further analyzed. Having an opportunity to examine these data allowed for some rough predictions to be made in terms of the reasons for these incidents occurring more and less frequently within specific areas of Toronto. For instance, the number of collisions in speed reduction zones should drop where the speed limit is lower. Further analysis is required to determine if this is the case.

  This analysis is intended to find ways to reduce these incidents as injury and fatality rates are higher in some areas. If fines can be increased in these areas, along with adding additional traffic enforcement, these incidents may be prevented from occurring in the future. There are likely more conclusions and solutions that will be determined as the data is further analyzed as various other factors will be examined, supplementing this general outlook. Overall, having a better insight on this issue can help generate ideas on how to reduce motor collision incidents within school zones in the City of Toronto.

# Background

Canada has shown an improvement in road and transport safety over the years as collision fatalities and injuries have exhibited a declining trend. Nevertheless, vehicular collisions remain a prominent threat to the lives, bodies, bank accounts, and general well-being of Canadians. In 2018, collisions resulted in 1500 fatalities and 152,847 injuries (Transport Canada, 2020).  “On-road” collisions have been a majority source of child fatalities for many years in Canada, and despite the lowering rate, these collisions comprise  49% of fatalities affecting children aged 0-14 with only 13% of them occurring when the child is a passenger (Parachute, 2016). This outlines that child pedestrians are at risk of being fatally struck by vehicles. To counteract this, school zones are established to protect children in and around areas they frequently gather (i.e. schools). School zones are strips of road near schools or childcare areas, delineated by a lower maximum speed limit and an inability to pass in either lane. These zones have been shown to effectively reduce the number of fatal and injury inducing crashes by ~4% per a 1km/h decrease in speed limit (Sun et al., 2018, p. 1087).

School zones seem to be effective in idealized scenarios but concerns exist due to unequal zone states in which municipalities and drivers are responsible for creating. Municipalities establish school zones and determine their features (location, length, speed limit, etc) and in the end, drivers must make the effort to consciously follow the rules and make safe choices when in a zone. This is not guaranteed: on average in Toronto 21% of drivers speed while in school zones with percentages climbing as high as 85% in specific zones, which road safety advocates blame partially on infrastructure that promotes fast driving (ex. straightaways and four-lane traffic) (Rocha & Pelley, 2020). Speeding alone is not the only threat to school zone safety; illegal parking and distracted driving have both been identified as some of the most common unsafe behaviours demonstrated by drivers in school zones (CAA polling, 2019). If these actions are as common as they are reported to be, then are school zones not uniformly deterring drivers from unsafe behaviours?

In conclusion, school zones are effective, but are they effective unilaterally and are their features optimized for reducing the ever-present threat of collisions for younger generations? This study has value in that it provides a deeper understanding of the efficacy of school zones as it gives insight into the spatial distributions of crashes within them, potentially establishing zones with varying intensities, opposed to taking efficacy averages. Through this, hotspots and trends in school zone contained collisions can be developed, outlining regions that should be addressed.


# Predictions

The research question asks if there is a direct relationship between collisions involving pedestrians and the presence of speed reduction zones. Due to the proven efficacy of safety zones, it is predicted that these areas will experience fewer collisions than areas without safety zones. Conversely, it is probable that areas that experience more collisions than others will be found to lack adequate safety features.

Several factors may affect the reliability and accuracy of the data analysis conducted. If a safety zone was recently established in an area, it is possible that a significant number of collisions occurred there to necessitate its creation, skewing the number of events in this zone. This is solved by comparing the zone implementation date to the collision event date, both of which are fields present in the collisions shapefile. As well, areas with a higher population density and greater traffic flow are more likely to have collisions. The active hours of a safety zone are also of relevance. Some safety signs are turned off outside of school hours, raising the speed limit to facilitate greater traffic flow. If collisions occurred at this time, this would give the appearance of greater collisions in a safety zone, when in fact the zone was not active. Fortunately, collision time and zone active hours are recorded in the collision and safety zone shapefiles, respectively, solving this issue. Finally, other roadway conditions play a role in collision frequency, such as lighting, road state (icy, dry, etc.), and visibility. If little correlation is found between safety zones and collisions, perhaps one of these fields will prove more significant.

# Study area

Toronto has adapted to be a very diverse city over the last 30 years with a mass increase in car usage and general population living near the downtown core. As this high density area  has had a dramatic increase in car usage, more collisions are prominent to occur. As Toronto is a city known by all in Ontario, it is beneficial to examine this particular area of study in order to see if there are any trends between car collisions and speed reduction zones. This is of great benefit to all individuals within the surrounding area.The data will go through a series of tests in order to further analyse trends and determine if any changes need to be made or if solutions can be created to solve/reduce them.

Other cities such as New York, Chicago, Houston, and Los Angeles could have been used, although it was determined that the best choice would be Toronto as it is the area closest to McMaster, and the one that the majority of McMaster students are familiar with. Hamilton could have also been chosen, but the data available for Hamilton were deemed insufficient for the types of analysis that were required to make sufficient conclusions about school safety zones. To determine the relationship between collisions and safety zones, sources from the City of Toronto along with transportation trends within the area are examined. Using R-Studio, these data will be plotted on maps and further analyzed to find common trends between the different datasets to determine a conclusion.


```{r Toronto-Bound, echo=FALSE, warning=FALSE, message=FALSE, results=FALSE, fig.cap={"\\label{fig:Toronto-Bound}Boundaries of Toronto, Canada (2021)"}}
#lines 270-300 from code rmd file
#read shapefile
toronto_boundary <- st_read(
  "data/toronto-boundary-wgs84/citygcs_regional_mun_wgs84.shp")

#convert polygon to group of lines
toronto.lines = st_cast(toronto_boundary,"LINESTRING")

#convert lines to points
toronto_points <- st_cast(toronto.lines, to = "POINT")

toronto_points <- as.data.frame(toronto_points)
#AT THIS POINT I EXTRACTED toronto_points AS A CSV AND SEPARATED THE LNG AND LAT IN SHEETS (Toronto_Points)

#converting points from WGS84 to UTM17N
coordinates(Toronto_Points) <- c("LNG", "LAT")
proj4string(Toronto_Points) <- CRS("+proj=longlat +datum=WGS84")
Toronto_Points.trfm <- spTransform(Toronto_Points, CRS("+proj=utm +zone=17 ellps=WGS84"))
Toronto_Points <- as(Toronto_Points.trfm, "SpatialPoints")

Toronto_Points.df <- as.data.frame(Toronto_Points)

#convert Toronto boundary points to polygon 
poly <- Polygon(Toronto_Points.df)
poly2 <- Polygons(list(poly),1)
Toronto_Poly <- SpatialPolygons(list(poly2))
plot(Toronto_Poly)

#convert polygon to simple feature and assign as window
Toronto_Poly <- st_as_sf(Toronto_Poly)
Toronto.owin <- as.owin(as(Toronto_Poly, "Spatial"))
```

It is extremely beneficial to choose an area of study that is significant to the researchers. This will allow connections to be made with the areas affected or specific trends that are seen throughout the analysis. Having background knowledge on a specific area or type of data can always allow for an easier, and more in depth analysis. For this instance, the most beneficial would have been a specific area in Toronto, although all of Toronto was chosen in order to have more variety in trends and to be able to truly see the impacts of collisions and speed reduction zones.

The area of Toronto that will be examined is shown below in Figure. \ref{fig:Toronto-Bound}

# Data & Methods

The data for this project is sourced from the City of Toronto Open Data website. The data on the speed reduction zones is provided by the Transportation Services department of the City of Toronto. This dataset displays points for where the speed reduction zone radars are located, the speed reading at which the device flashes, the speed limit, as well as other attributes. These speed reduction zones are used by the Watch Your Speed Program (WYSP). To compliment these data, a detailed count of speeds measured by the aforementioned radars is also used and is also provided by Transportation Services. To give geographical context as to where the schools in Toronto are located, a dataset featuring the location of schools is used. This dataset is provided by 311 Toronto and is collected by the Planning Division of the Toronto District School Board. The primary examination of this project is to analyze the effectiveness of speed reduction zones. To do this, a dataset featuring motor vehicle collisions is used. This dataset, provided by the Toronto Police Services, features the participants involved in the collision (pedestrians, cyclists, automobiles, etc.), when and where the collision occurred, as well as other key factors such as the visibility at the time of the collision. As previous studies have shown, speed reduction zones are effective at reducing the number of collisions in the zone. Analyzing the data for Toronto helps verify this notion and can also act as an incentive to improve the speed reduction zones in Toronto if they are deemed ineffective.

Since data variations occur over the years, more recent data will be used to be as accurate to current as possible. Some of the datasets date as far back as 2006 which could be of benefit to see if there were any improvements or decline over time. Multiple factors will be examined to determine our final conclusions. Quadrat analysis, heat maps, buffer zones around the safety zones, and statistical tests will all be applied.

A GitHub repository was used to store relevant project data, including the City of Toronto data, which was able to be imported into RStudio through the GitHub pathway. The source data used includes the WYSP sign locations, 2006 - 2019 collision locations, and the location of all learning facilities (schools, daycares, montessori, etc.) within Toronto. This data, including the Toronto boundary polygon, were initially assigned the WGS84 geographic coordinate system geometry, which proved to be an issue with quadrat analysis as that method requires a projected coordinate system. As such, the points of the source data were converted to WGS84’s corresponding UTM zone (UTM 17N), and the northings and easting were then able to be used by the quadrat function. To transform the Toronto boundary polygon geometry it was first converted into polyline segments, points were then spaced at uniform distances along each polyline. These points were then converted to UTM 17N and built back up into the Toronto boundary polygon. This enabled analysis via quadrats.

Quadrat, heatmap, and buffer analysis all provide an insight into the distribution of collisions but in various forms, each with their own specialty. Heatmap analysis is highly qualitative as far as its look into distribution goes. It provides a clear visual of high and low density zones by drawing a coloured circle at each observation, with the colour becoming more intense as these circles overlap. To actually analyze the data, a quantitative approach was also used to, instead of visualizing distribution, understand it through quadrat counts. This works by laying a grid of specified dimensions over an analysis window, in this case the Toronto boundary, and then counting the number of observations in each grid square. Quadrat analysis was also applied to the WYSP locations and the learning facility locations, allowing us to compare and contrast the datasets’ distributions and learn of any major discrepancies in quadrat counts between them. Buffer analysis works via drawing a circle of specified radius around each observation and then counting the observations within that radius; in this case the circle is placed around the WYSP locations and collisions within its buffer are counted. This gives a view into how collisions are distributed relative to the school zone signs, and if existing school zones are helping prevent collisions by deterring unsafe driving practices. With these three analysis methods, it is possible to portray a clear picture of the efficacy of school zones and where new school zones are needed across Toronto.



# Results

```{r GGPLOT1, echo=FALSE, fig.cap={"\\label{fig:Col-SchoolZ}Collisions, Schools and Speed Signs of Toronto, Canada (2006-2019)"}}
ggplot() +
  geom_sf(data = Schools.sf, color = "grey") +
  geom_sf(data = School_Zones.sf, color = "yellow") +
  geom_sf(data = Collisions.sf, color = "red") +
  labs(title = "Collisions, Schools and Speed Signs")
```

To begin the research study process, data was collected from various sources corresponding to recent City of Toronto data. The data was combined within a single dataframe in order to see general trends within the data. This included the variables Collisions (Red), Schools (Grey) and Schools Zones (Yellow). For the first step of this process, the variables were all gathered and plotted into one map using ggplot.  

```{r leaflet-prep, echo=FALSE}
#icon creation for main leaflet
schoolIcon <- makeIcon(
  iconUrl = "https://www.freeiconspng.com/uploads/school-house-icon-16.png",
  iconWidth = 10, iconHeight = 10
)
smallschoolIcon <- makeIcon(
  iconUrl = "https://www.freeiconspng.com/uploads/school-house-icon-16.png",
  iconWidth = 05, iconHeight = 05
)
zonesIcon <- makeIcon(
  iconUrl = "https://www.freeiconspng.com/uploads/school-icon-png-40.png",
  iconWidth = 10, iconHeight = 10
)
collisionsIcon <- makeIcon(
  iconUrl = "https://www.freeiconspng.com/uploads/-alert-attention-danger-exclamation-safety-warning-icon--icon--33.png",
  iconWidth = 10, iconHeight = 10
)
smallzonesIcon <- makeIcon(
  iconUrl = "https://www.freeiconspng.com/uploads/school-icon-png-40.png",
  iconWidth = 05, iconHeight = 05
)
```
The following section, Figure. \ref{fig:Col-SchoolZ} is similar to Figure. \ref{fig:Toronto}. Each variable has a symbol instead of strictly a color.The red symbol represents collisions, the black building represents schools, and the purple school signs represent school zones. This map shows the same data stated previously, although the points are more distinctive due to the symbology and that they are on an actual map rather than a plot. 

```{r leaflet1, echo=FALSE, fig.cap={"\\label{fig:Toronto}Leaflet of Collisions, Schools and Speed Signs Toronto, Canada (2006-2019)"}}
#Main data sets leaflet
overview.map <- leaflet() %>% addTiles() %>%
    setView(lng = -79.38, lat = 43.73, zoom = 10) %>% 
  addMarkers(data = Collisions.sf, icon = collisionsIcon) %>%
  addMarkers(data = School_Zones.sf, icon = zonesIcon) %>%
  addMarkers(data = Schools.sf, icon = schoolIcon)


overview.map


```




\newpage

A series of heat maps were then created in order to see the differences between all collisions occurring from 2006-2019, as well as collisions strictly involving pedestrians and cyclists in 2019. Figure. \ref{fig:Heat Map1} shows the areas that contained the most collisions within the time frame of 2006-2019. This accounts for pedestrian, vehicles and bicycle collisions all within one heat map. Figure. \ref{fig:Heat Map2} shows the areas involving collisions with pedestrians and cyclists aged 0-19 from the years 2006-2019.

```{r 2019-collision-hmap, echo=FALSE, fig.cap={"\\label{fig:Heat Map1}Heat Map of All Collisions in Toronto, Canada (2006-2019)"}}
#leaflet map containing the point locations of 2019 collisions
collisions.map <- leaflet() %>% addTiles() %>%
  addMarkers(data = Collisions.sf, icon = collisionsIcon)

#setting necessary coords as numeric values
Collisions$lng <- as.numeric(Collisions$lng)
Collisions$lat <- as.numeric(Collisions$lat)

Full_Collisions$lng <- as.numeric(Full_Collisions$lng)
Full_Collisions$lat <- as.numeric(Full_Collisions$lat)

Kid_Collisions$lng <- as.numeric(Kid_Collisions$lng)
Kid_Collisions$lat <- as.numeric(Kid_Collisions$lat)

#creation of 2019 collisions heatmap
collisions.hmap <- leaflet(data = Collisions) %>% 
  setView(lng = -79.38, lat = 43.73, zoom = 10) %>% 
  addTiles()


#2019 collisions heatmap 
collisions.hmap %>% addHeatmap(lng = ~lng, lat = ~lat, intensity = 1,
             blur = 39, max = 1, radius = 17)
```


```{r kid-collisions-hmap, echo=FALSE, fig.cap={"\\label{fig:Heat Map2}Heat Map of Collisions Involving Pedestrians and Cyclists Aged 0-19 in Toronto, Canada (2006-2019)"}}
#2006 – 2019 collisions involving only pedestrian and cyclist collisions involving people aged 0-19 heatmap
kid_collisions.hmap <- leaflet(data = Kid_Collisions) %>% 
  setView(lng = -79.38, lat = 43.73, zoom = 10) %>% 
  addTiles()

#kid collisions hmap
kid_collisions.hmap %>% addHeatmap(lng = ~lng, lat = ~lat, intensity = 1,
             blur = 39, max = 1, radius = 17)
```



```{r quadrat-prep, include=FALSE}
#Conversion of WGS84 lat and lng points to corresponding UTM17N eastings and northings
CollisionsXY <- Collisions %>%
  select(lng, lat)

CollisionsXY$lat <- as.numeric(CollisionsXY$lat)
CollisionsXY$lng <- as.numeric(CollisionsXY$lng)

coordinates(CollisionsXY) <- c("lng", "lat")
proj4string(CollisionsXY) <- CRS("+proj=longlat +datum=WGS84")
Collisions.trfm <- spTransform(CollisionsXY, CRS("+proj=utm +zone=17 ellps=WGS84"))
CollisionsPCS <- as(Collisions.trfm, "SpatialPoints")

#USE FOR QUADRAT
CollisionsPCS.sf <- st_as_sf(CollisionsPCS)
Collisionscopy.sf <- Collisions.sf
Collisionscopy.sf[, "geometry"] <- CollisionsPCS.sf[,"geometry"]

#USE 'CollisionsPCS.sf' FOR QUADRAT
CollisionsPCS.sf <- Collisionscopy.sf


SchoolsXY <- Schools %>%
  select(lng, lat)

SchoolsXY$lat <- as.numeric(SchoolsXY$lat)
SchoolsXY$lng <- as.numeric(SchoolsXY$lng)

coordinates(SchoolsXY) <- c("lng", "lat")
proj4string(SchoolsXY) <- CRS("+proj=longlat +datum=WGS84")
Schools.trfm <- spTransform(SchoolsXY, CRS("+proj=utm +zone=17 ellps=WGS84"))
SchoolsPCS <- as(Schools.trfm, "SpatialPoints")


SchoolsPCS.sf <- st_as_sf(SchoolsPCS)
Schoolscopy.sf <- Schools.sf
Schoolscopy.sf[, "geometry"] <- SchoolsPCS.sf[,"geometry"]

#USE 'SchoolsPCS.sf' FOR QUADRAT
SchoolsPCS.sf <- Schoolscopy.sf


School_ZonesXY <- School_Zones %>%
  select(lng, lat)

School_ZonesXY$lat <- as.numeric(School_ZonesXY$lat)
School_ZonesXY$lng <- as.numeric(School_ZonesXY$lng)

coordinates(School_ZonesXY) <- c("lng", "lat")
proj4string(School_ZonesXY) <- CRS("+proj=longlat +datum=WGS84")
School_Zones.trfm <- spTransform(School_ZonesXY, CRS("+proj=utm +zone=17 ellps=WGS84"))
School_ZonesPCS <- as(School_Zones.trfm, "SpatialPoints")

#USE FOR QUADRAT
School_ZonesPCS.sf <- st_as_sf(School_ZonesPCS)
zonescopy.sf <- School_Zones.sf
zonescopy.sf[, "geometry"] <- School_ZonesPCS.sf[,"geometry"]

#USE 'School_ZonesPCS.sf' FOR QUADRAT
School_ZonesPCS.sf <- zonescopy.sf

```


\newpage

A quadrat analysis was also done for each variable in order to derive event density by cell rather the whole city. Variable 1(Collisions) density is shown in Figure. \ref{fig:Quadrat of Collisions}, Variable 2 (Speed Signs) density is shown in Figure. \ref{fig:Quadrat of Speed Signs} and Variable 3 (School) density is shown in Figure. \ref{fig:Quadrat of Schools}. This is beneficial to understand whether or not speed signs have an impact on the number of collisions that occur within school zones. 



```{r Collisions-quadrat, warning=FALSE, echo=FALSE,message=FALSE,results=FALSE,fig.cap={"\\label{fig:Quadrat of Collisions} Quadrat Count of collisions in Toronto, Canada (2006-2019)"}}
collisions.ppp <- as.ppp(st_coordinates(CollisionsPCS.sf), W = Toronto.owin)
Quadrat_Count_of_Collisions <- quadratcount(collisions.ppp, nx = 5, ny = 5)
plot(Quadrat_Count_of_Collisions)
Quadrat_Test_of_Collisions <- quadrat.test(collisions.ppp, nx = 5, ny = 5)
Quadrat_Test_of_Collisions
```

```{r Speed-Signs-quadrat, warning=FALSE, echo=FALSE,message=FALSE,results=FALSE, fig.cap={"\\label{fig:Quadrat of Speed Signs}Quadrat Count of Speed Signs in Toronto, Canada (2006-2019)"}}
speedsigns.ppp <- as.ppp(st_coordinates(School_ZonesPCS.sf), W = Toronto.owin)
Quadrat_Count_of_Speed_Signs <- quadratcount(speedsigns.ppp, nx = 5, ny = 5)
plot(Quadrat_Count_of_Speed_Signs)
Quadrat_Test_of_Speed_Signs <- quadrat.test(speedsigns.ppp, nx = 5, ny = 5)
Quadrat_Test_of_Speed_Signs
```

```{r Schools-quadrat, warning=FALSE, echo=FALSE, message=FALSE, results=FALSE, fig.cap={"\\label{fig:Quadrat of Schools}Quadrat Count of Schools in Toronto, Canada (2006-2019)"}}
Schools.ppp <- as.ppp(st_coordinates(SchoolsPCS.sf), W = Toronto.owin)
Quadrat_Count_of_Schools <- quadratcount(Schools.ppp, nx = 5, ny = 5)
plot(Quadrat_Count_of_Schools)
Quadrat_Test_of_Schools <- quadrat.test(Schools.ppp, nx = 5, ny = 5)
Quadrat_Test_of_Schools
```

\newpage
A quadrat test was then conducted for each individual variable which is shown in the table below. It states the P-Values determined, the number of tiles, and the Chi-Squared Test (X2) output. The number of tiles remains consistent in order to keep a consistent set number of tiles for each Toronto boundary. This allows easier comparisons to be made within each cell between all variables rather than having to differentiate between cell sizes. 

```{r Quadrat_Test_Results, echo=FALSE, warning=FALSE, message=FALSE}

# Create a table displaying Quadrat Results
Quadrat_Test_Results <- matrix(c(2.2e-16,2.988e-08,2.2e-16,21,21,21,288.9,76.561,195.86),ncol=3,byrow=TRUE)
colnames(Quadrat_Test_Results) <- c( " Collisions "," Speed Signs "," Schools ")
rownames(Quadrat_Test_Results) <- c("P-Value","Number of Tiles","Chi-Squared Test X2")
Quadrat_Test_Results <- as.table(Quadrat_Test_Results)
Quadrat_Test_Results
```





```{r buffer-prep, echo=FALSE, warning=FALSE, message=FALSE, results=FALSE}
SZ_km = st_transform(School_ZonesPCS.sf, "+proj=utm +zone=17N +datum=WGS84 +units=km")
Coll_km = st_transform(CollisionsPCS.sf, "+proj=utm +zone=17N +datum=WGS84 +units=km")
Schools_km = st_transform(SchoolsPCS.sf, "+proj=utm +zone=17N +datum=WGS84 +units=km")

School_buffer0.5 = st_buffer(Schools_km, 0.5)
School_Coll0.5 = st_intersection(School_buffer0.5, Coll_km)
School_Coll0.5.sf <- st_as_sf(School_Coll0.5)
School_buffer0.25 = st_buffer(Schools_km, 0.25)
School_Coll0.25 = st_intersection(School_buffer0.25, Coll_km)
School_Coll0.25.sf <- st_as_sf(School_Coll0.25)
School_buffer0.1 = st_buffer(Schools_km, 0.1)
School_Coll0.1 = st_intersection(School_buffer0.1, Coll_km)
School_Coll0.1.sf <- st_as_sf(School_Coll0.1)
School_buffer0.5 = st_buffer(Schools_km, 0.5)
School_speed0.5 = st_intersection(School_buffer0.5, SZ_km)
School_speed0.5.sf <- st_as_sf(School_speed0.5)
School_buffer0.25 = st_buffer(Schools_km, 0.25)
School_speed0.25 = st_intersection(School_buffer0.25, SZ_km)
School_speed0.25.sf <- st_as_sf(School_speed0.25)
School_buffer0.1 = st_buffer(Schools_km, 0.1)
School_speed0.1 = st_intersection(School_buffer0.1, SZ_km)
School_speed0.1.sf <- st_as_sf(School_speed0.1)
SZ_buffer0.5 = st_buffer(SZ_km, 0.5)
SZ_Coll0.5 = st_intersection(SZ_buffer0.5, Coll_km)
SZ_Coll0.5.sf <- st_as_sf(SZ_Coll0.5)
SZ_buffer0.25 = st_buffer(SZ_km, 0.25)
SZ_Coll0.25 = st_intersection(SZ_buffer0.25, Coll_km)
SZ_Coll0.25.sf <- st_as_sf(SZ_Coll0.25)
SZ_buffer0.1 = st_buffer(SZ_km, 0.1)
SZ_Coll0.1 = st_intersection(SZ_buffer0.1, Coll_km)
SZ_Coll0.1.sf <- st_as_sf(SZ_Coll0.1)
```



```{r 0.5-total, echo=FALSE, fig.cap={"\\label{fig:Buffer 500m} Collisions and speed signs within 500m of schools and Collisions within 500m of Speed signs in Toronto, Canada (2006-2019)"}}
ggplot() +
  geom_sf(data = School_Coll0.5.sf, color = "red") +
  geom_sf(data = School_speed0.5.sf, color = "green") +
  geom_sf(data = SZ_Coll0.5.sf, color = "black")
#dim(School_Coll0.5)
#dim(School_speed0.5)
#dim(SZ_Coll0.5)
```

```{r 0.25-total, echo=FALSE,fig.cap={"\\label{fig:Buffer 250m} Collisions and speed signs within 250m of schools and Collisions within 250m of Speed signs in Toronto, Canada (2006-2019)"}}
ggplot() +
  geom_sf(data = School_Coll0.25.sf, color = "red") +
  geom_sf(data = School_speed0.25.sf, color = "green") +
  geom_sf(data = SZ_Coll0.25.sf, color = "black")
#dim(School_Coll0.25)
#dim(School_speed0.25)
#dim(SZ_Coll0.25)
```

```{r 0.1-total, echo=FALSE, warning=FALSE, message=FALSE, results=FALSE,fig.cap={"\\label{fig:Buffer 100m} Collisions and speed signs within 100m of schools and Collisions within 100m of Speed signs in Toronto, Canada (2006-2019)"}}
ggplot() +
  geom_sf(data = School_Coll0.1.sf, color = "red") +
  geom_sf(data = School_speed0.1.sf, color = "green") +
  geom_sf(data = SZ_Coll0.1.sf, color = "black")

#School_Coll0.1.sf
#SZ_Coll0.1.sf$address
#dim(School_Coll0.1)
#dim(School_speed0.1)
#dim(SZ_Coll0.1)
```



\newpage

Finally, buffers were created to analyze correlations at a more local scale, thus examining the data at set distance intervals. Figure. \ref{fig:Buffer 500m} shows collisions (red) and speed signs (green) within 500m of schools and collisions within 500m of speed signs (black). Figure. \ref{fig:Buffer 250m} and Figure. \ref{fig:Buffer 100m} are similar, with buffers of 250m and 100m instead. 


Having created and used various different methods to analyze the data selected by the researchers, it is seen that there are various trends that can be examined. In the analysis, the factors that have been determined will be discussed in more depth along with the correlation between with all the variables. If there are things that can be improved, suggestions will be made along with further inspection of the events that have occurred. 



# Analysis

**Collisions, Schools, and Speed Signs Plot**

Figure. \ref{fig:Col-SchoolZ} shows collisions occurring in 2019. Additionally, it contains schools and speed signs present during this time. This map is useful to gain a general overview of the collision dispersion in Toronto. Collisions appear clustered in specific areas, such as in the downtown core and along major arterial roads. Meanwhile, there are also clusters of schools with no collisions or speed signs, such as in the north-west and north-central areas of the city. This disparity in collision location may be the result of traffic flow (i.e, less traffic in areas devoid of collisions), less pedestrian and cyclist activity, or underreporting of collisions. 

However, from this plot, it does appear as though accidents occur despite the presence of speed signs nearby. In order to reduce the occurrence of collisions, various things can be done. More speed signs can be added closer to schools to reduce speeds and prevent collisions. As well, speed fines can be increased, and more stop signs and stop lights can be added in these areas. Further analysis is required to determine the extent to which speed signs affect collision density.
\newline



**Collisions, Schools, and Speed Signs Leaflet Map**

This map Figure. \ref{fig:Toronto} is an enhanced version of the previous plot. This is a more useful visualization of the study area, as the symbols used accurately convey the events they represent without the need for a legend. As well, the basemap helps to explain the clustering observed in the previous plot, as more areas devoid of collisions are in fact green space or devoid of major roads. The plot and leaflet are limited in that they present a lot of data without summarizing it in a useful way. For this, heat maps and statistical analysis are required.
\newline



**Heat Maps of All Collisions and of Collisions Involving Pedestrians and Cyclists Aged 0-19**

The heat map shown in Figure. \ref{fig:Heat Map1} represents a high density of collisions in red, with a low density in blue. This confirms that some areas have a much higher density of collisions in comparison to others. This may be because there is not enough traffic enforcement within this area or not enough speed signs. These areas can be reduced significantly when the source of the majority of the accidents is determined.

The heat map shown in Figure. \ref{fig:Heat Map2} is specific to pedestrians and cyclists under the age of 20. Contrastingly, the areas with the highest density of collisions for this subset of the population are located east of the downtown core, as well as the north-west corner, near Pearson International Airport. The warmer average colour in this map indicates that collisions involving this subset are more evenly distributed than those in the previous map. It is stipulated that this is a result of the fairly uniform distribution of schools in Toronto. This indicates that there is a significant amount of accidents for this age group within the Toronto boundaries. Despite these observations, it is important to conduct empirical tests, as intuition about a pattern can be deceiving. 
\newline



**Quadrat Counts of Schools, Speed Signs, and Collisions**

The quadrat count of collisions supports the earlier assertion that collision events are more dense downtown. Predictably, quadrats cut off by the Toronto boundary should contain fewer events, as they have a much smaller area. However, schools are unevenly distributed in Toronto, favoring the south-central and north-central areas of the city. Meanwhile, speed signs are not correlated with either of these distributions at all, as speed sign density is highest in the south-west cells of the city. Many factors may affect this speed sign placement, such as perceived collision risk, severe historical collisions, as well as opposition to speed signs in high-traffic areas. This can be shown through Figure. \ref{fig:Quadrat of Collisions}, Figure. \ref{fig:Quadrat of Speed Signs} and Figure. \ref{fig:Quadrat of Schools}
\newline



**Quadrat Tests of Schools, Speed Signs, and Collisions**

In order to confirm the suspicion that collision density is non-random, quadrat tests were conducted as shown in the table previously. Given the extremely small P-values generated, the dispersion is in fact non-random, and therefore collisions occur within these areas for specific reasons. Finally, a Chi-squared test (X2) value reveals whether each event is independent of neighbouring events. For the most part all events were independent of one another, indicating that few to no collisions caused other events to occur in a similar fashion. 
\newline



**Event Density within Set Distances from Schools and Speed Signs**

The first buffer map depicts collisions within a 500m buffer of schools in red, speed signs within a 500m buffer of schools in green, and collisions within a 500m buffer of speed signs in black. As such, many events may occur within each buffer. While only two dozen black buffers are shown, 160 collisions occur in these areas. Similar gaps identified in Figure.\ref{fig:Buffer 500m} are seen in the north-west corner and north-central areas of Toronto, while clustering is evident downtown and throughout much of the city. Meanwhile, the 250m buffer (Figure. \ref{fig:Buffer 250m}) map eliminates many events, narrowing the results to within a closer vicinity of the schools and speed signs. The six black buffers shown contain 33 accidents, while the red and green buffers represent 285 collisions and 212 speed signs, respectively. Finally, the 100m buffer (Figure. \ref{fig:Buffer 100m}) map limits the results to those within the immediate vicinity of schools and speed signs. Here, 51 collisions events and 65 speed signs are found near schools, while only two accidents occurred near speed signs. 

The minimal overlap between speed signs and accidents demonstrated the effectiveness of speed signs at reducing speed and accidents, while the areas in red indicate areas lacking speed signs that would greatly benefit from their implementation. Such examples include the areas around Erudite Elementary School, Ace Acumen High School, Queen Victoria Junior Public School, and Centennial Road Junior Public School. 

This illustrates how at large scales (such as through quadrat and leaflet map analysis) speed signs seem to have little to no impact on collision occurrence, however through more rigorous statistical analysis and the use of heat maps it is evident that speed signs do play a role in reducing the number of collisions. Therefore, it is recommended that more speed signs be added to areas experiencing collision events, such as those near schools that are exhibiting high traffic flow.





# Conclusion

The purpose of this study was to determine the efficacy of speed reduction signs, specifically in the city of Toronto. With the use of various analytical techniques, such as quadrat analysis, heat maps, and buffers, it was shown that school safety signs were mostly effective. The buffer maps that were produced are an effective representation of the efficacy of these school zones. The final map shows only a single collision (shown in black) occurring within 100m of a school safety zone speed sign, while the other collisions (shown in red) that were within 100m of schools were not within 100m of any speed signs. One could conclude that collisions occur with a reduced frequency near speed signs.

School safety zones are shown to be effective and should be considered by policymakers looking to implement changes to improve road safety, particularly for areas around schools. However, this study was done on the city of Toronto and the conclusions may not apply to other cities in the same way. In order to make the best use of this study, policymakers and other researchers are encouraged to perform a similar analysis on their area of interest. For the case of cities like Hamilton, municipal governments are encouraged to provide sufficient data for this analysis to be possible for their city.

Furthermore, future researchers and policymakers may be interested in furthering this analysis on Toronto or performing a similar analysis and improving upon it for another region. For example, performing a buffer analysis with a road network in another software such as ArcGIS Pro would allow the analysts to address the issue with the buffers including areas that are close in terms of euclidean distance but not actual driving distance. Performing a statistical test such as a g-test could give the analysts insight on if collisions are randomly distributed throughout the area of study in relation to speed signs. A kernel density analysis would serve a similar purpose as a quadrat test but would account for variations in the data that may not be detected by a quadrat test. Finally, it may also be helpful to run various simulations on the placement of school safety zone speed signs and assessing their effects on deterring collisions. 




# References
311 Toronto (2019). Toronto District School Board Locations. Retrieved from 
  https://open.toronto.ca/dataset/toronto-district-school-board-locations/

CAA polling (2019). School Zone Safety Statistics. CAA. https://www.caa.ca/schoolzonesafety
	/statistics/

City Planning, City of Toronto (2021). Ward Profiles, 2014-2018 Wards. Retrieved
	from https://open.toronto.ca/dataset/ward-profiles-2014-2018-wards/

Information & Technology, City of Toronto (2021). Address Points (Municipal) - Toronto One 
  Address Repository. Retrieved from https://open.toronto.ca/dataset/address-points
  -municipal-toronto-one-address-repository/

Parachute (2016, June). Unintentional Injury Trends for Canadian Children. Retrieved from 
	https://parachute.ca/wp-content/uploads/2019/06/SKW-Trend-Report.pdf

Rocha, R., & Pelley, L. (2020, October 6). Toronto drivers speeding near schools 21% of the
  time, city data reveals. CBC. https://www.cbc.ca/news/canada/toronto/toronto-drivers
	-speeding-near-schools-21-of-the-time-city-data-reveals-1.5751299

Sun, D., El-Basyouny, K., Ibrahim, S., & Kim, A. M. (2018). Are school zones effective in 
	reducing speeds and improving safety? Canadian Journal of Civil Engineering, 45(12),
	1084–1092. https://doi.org/10.1139/cjce-2018-0060

Toronto Police Services (2020). Motor Vehicle Collisions involving Killed or Seriously
  Injured Persons. Retrieved from https://open.toronto.ca/dataset/motor-vehicle-collisions
  -involving-killed-or-seriously-injured-persons/

Transportation Services, City of Toronto (2020). speed reduction Zone Watch Your Speed
	Program – Detailed Speed Counts. Retreived from https://open.toronto.ca/dataset
	/school-safety-zone-watch-your-speed-program-detailed-speed-counts/

Transportation Services, City of Toronto(2021). speed reduction Zone Watch Your Speed Program 
  – Locations. Retrieved from https://open.toronto.ca/dataset/school-safety-zone-watch
	-your-speed-program-locations/

Transport Canada (2020, December 1). Canadian Motor Vehicle Traffic Collision Statistics: 
	2018. Government of Canada. https://tc.canada.ca/en/road-transportation/motor-vehicle
	-safety/canadian-motor-vehicle-traffic-collision-statistics-2018

